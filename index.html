<html>
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style>
		body {
			padding: 0;
			margin: 0;
			background: #c4d2f5;
			background: linear-gradient(to right, #25c481, #25b7c4);
			font-family: 'Roboto', sans-serif;
			color: #fff;
		}
		h1 {
			text-align: center;
		}
		
		#search-bar {
			display: flex;
			justify-content: flex-end;
		}
		main {
			width: 90%;
			max-width: 1000px;
			margin: auto;
			padding: 20px;
		}

		#data {
			width: 100%;
			border: 1px solid #67d6aa;
		}
		#data #list-header {
			font-size: 14px;
			display: flex;
		    line-height: 1.618;
		    color: #fff;
		    background-color: rgba(255,255,255,0.3);
		    padding: 10px 10px;
		}

		#data #list {
			padding: 0;
			margin: 0;
		}
		#data #list li{
			display: flex;
			font-size: 13px;
		    font-weight: 400;
		    line-height: 1.618;
		    padding: 10px 10px;
		    border-bottom: 1px solid #67d6aa52;
		    /*color: #5e5e5e;*/
		}
		#data .search-not-found {
			text-align: center;
			font-size: 20px;
			font-weight: bolder;
			padding: 20px !important;
		}
		#data .name {
			width: 20%;
		}
		#data .id {
			width: 7%;
		}
		#data .nametype {
			width: 11%;
		}
		#data .recclass {
			width: 12%;
		}
		#data .mass {
			width: 10%;
		}
		#data .fall {
			width: 10%;
		}
		#data .year {
			width: 10%;
		}
		#data .latitude {
			width: 10%;
		}
		#data .longitude {
			width: 10%;
		}
		.pagination {
			margin-top: 20px;
			display: flex;
			width:100%; 
			justify-content: center;
		}
		.pagination a {
		  color: #fff;
		  padding: 8px 8px;
		  text-decoration: none;
		  transition: background-color .3s;
		  border: 1px solid #ddd;
		  font-size: 16px;
		  cursor: pointer;
		}

		.pagination a#active {
		  background-color: rgba(255,255,255,0.3);
		}

		.pagination a.disable {
			color: #25c194 !important;
			pointer-events: none;
			cursor: default;
		}

		.pagination a:hover:not(.active):not(.disable) {
		  background-color: #ddd;
		}
	</style>
</head>
<body>
	<main>
		<h1>Memeteorite Explorer</h1>
		<div id="search-bar">
			<input type="text" id="search-box" placeholder="Enter search term">
			<button id="search-btn">Search</button>
		</div>
		<div id="data">
			<div id="list-header">
				<span class="name">Name</span>
				<span class="id">Id</span>
				<span class="nametype">Name Type</span>
				<span class="recclass">Rec class</span>
				<span class="mass">Mass(g)</span>
				<span class="fall">Fall</span>
				<span class="year">Year</span>
				<span class="latitude">Latitude</span>
				<span class="longitude">Longitude</span>
			</div>
			<ul id="list">
			</ul>
		</div>
		<div class="pagination">
			<a id="first" class="disable">First</a>
			<a class="numbers" id="active">1</a>
			<a class="numbers">2</a>
			<a class="numbers">3</a>
			<a class="numbers">4</a>
			<a class="numbers">5</a>
			<a class="numbers">6</a>
			<a class="numbers">7</a>
			<a class="numbers">8</a>
			<a class="numbers">9</a>
			<a class="numbers">10</a>
			<a id="last">Last</a>
			<a id="prev" class="disable">&laquo;</a>
			<a id="next">&raquo;</a>
		</div>
	</main>
	<script>
		const createItems = (id, child) => {
			let father = typeof id == 'string'?  document.getElementById(id): id;
			if(!father) {
				let ans = document.getElementById('data');
				father = document.createElement('ul');
				father.id = 'list';
				ans.append(father);
			}
			let c = document.createElement(child)
			father.append(c);
			return c;
		}

		const deleteItems = (id) => {
			let f =  document.getElementById('data');
			let child = document.getElementById(id);
			f.removeChild(child);
		}

		const multiDimensional = (arr, size) => {
			var res = []; 
			for(var i=0;i < arr.length;i = i+size)
				res.push(arr.slice(i,i+size));
			return res;
		}

		const filtering = (items, item) => {
			if (item === 'latitude' || item === 'longitude') {
				if(!items.geolocation) return 'unknown';
				items[item] = items.geolocation.longitude
				items[item] = items.geolocation.latitude;
				return items[item]
			}
			if(!items[item]) {
				return 'unknown';
			}
			if(item === 'year') {
				return items[item].replace(/-.+/, '');
			}
			return items[item];
		}


		const each = (items) => {
			let li = createItems('list', 'li');
			let keys = [
				'name', 'id', 'nametype','recclass', 'mass',
				'fall', 'year', 'latitude', 'longitude'
				];

			for(let i in keys){
				let span = createItems(li, 'span');
				span.className = keys[i];
				span.innerText = filtering(items, keys[i]);
			}
		}

		const paginationHandler = () => {

		}

		const searchHandler = () => {

		}

		const loadData = (data) => {
			let pageBtns = document.getElementsByTagName('a');

			let newData = multiDimensional(data, 10);
			newData[0].forEach(obj=> each(obj));

			const activeTag = (a) => document.getElementById(a);

			let firstBtn = document.getElementById('first');
			let lastBtn = document.getElementById('last');
			let prevBtn = document.getElementById('prev');
			let nextBtn = document.getElementById('next');
			let numbersBtn = document.getElementsByClassName('numbers');
			let nextPrev = false;
			let count;
			let select = 0;


			const PAGI = (index = 1, start = false, sign = true) => {
				if(sign){
					for(let i = 0; i < numbersBtn.length; i++){
						numbersBtn[i].innerText = start? i+1:  Number(numbersBtn[i].innerText) + index;
					}
				}else {
					for(let i = 0; i < numbersBtn.length; i++){
						numbersBtn[i].innerText = start? i-1:  Number(numbersBtn[i].innerText) - index;
					}
				}
			}


			for(let i = 0; i < pageBtns.length; i++){
				pageBtns[i].onclick = function(event) {
					let clickedTag = event.target;
					let page = Number(activeTag('active').innerText);
					count = nextPrev? page - 2 : count;

					deleteItems('list');
					
					if(clickedTag.id === 'first'){ // clicked Tag is a number...
						select = 0;
						newData[0].forEach(obj=> each(obj));
						activeTag('active').id = '';
						numbersBtn[select].id = 'active'; 
						lastBtn.className = '';
						nextBtn.className = '';
						firstBtn.className = 'disable';
						prevBtn.className = 'disable';
						PAGI(1, true);
					}
					else if(clickedTag.id === 'last'){
						select = 9;
						nextPrev = true;
						newData[99].forEach(obj=> each(obj));
						activeTag('active').id = '';
						numbersBtn[numbersBtn.length - 1].id = 'active'; 
						firstBtn.className = '';
						prevBtn.className = '';
						lastBtn.className = 'disable';
						nextBtn.className = 'disable';
						PAGI(91 - numbersBtn[0].innerText, false,);
					}
					else if(clickedTag.id === 'next') { // clicked Tag is equal to next...
						nextPrev = true;
						newData[page].forEach(obj=> each(obj));
						if(page >= 6 && page < 96) {
							select = 5;
							activeTag('active').id = '';
							numbersBtn[select].id = 'active';
							if(numbersBtn[numbersBtn.length - 1].innerText < 100 ) {
								PAGI();
							}
						}else {
							select++;
							activeTag('active').id = '';
							numbersBtn[select].id = 'active';
							firstBtn.className = '';
							prevBtn.className = '';

						}

						if(activeTag('active').innerText === '100'){
							lastBtn.className = 'disable';
							nextBtn.className = 'disable';
						}
					}
					else if(clickedTag.id === 'prev') { // clicked Tag is equal to previous...
						nextPrev = false;
						newData[count].forEach(obj=> each(obj));
						count--;
						if(page > 6 && page < 97) {
							select = 5;
							activeTag('active').id = '';
							numbersBtn[select].id = 'active';
							if(numbersBtn[0].innerText > 1){
								PAGI(1,false,false);
							}
						}else {
							select--;
							activeTag('active').id = '';
							numbersBtn[select].id = 'active';
							if(activeTag('active').innerText === '1'){
								firstBtn.className = 'disable';
								prevBtn.className = 'disable';
							}else {
								firstBtn.className = '';
								prevBtn.className = '';
								nextBtn.className = '';
								lastBtn.className = '';
							}
						}
					}
					else if(clickedTag.className === 'numbers') { // clicked Tag is equal to First...
						nextPrev = true;
						newData[Number(clickedTag.innerText) - 1].forEach(obj=> each(obj));
						if(clickedTag.innerText >= 6 && clickedTag.innerText < 97) {
							activeTag('active').id = '';
							numbersBtn[5].id = 'active';
							firstBtn.className = '';
							prevBtn.className = '';
							PAGI(clickedTag.innerText - numbersBtn[5].innerText);
						} 
						else {
							activeTag('active').id = '';
							clickedTag.id = 'active';
							if(activeTag('active').innerText === '1'){
								firstBtn.className = 'disable';
								prevBtn.className = 'disable';
							}else {
								firstBtn.className = '';
								prevBtn.className = '';
							}

							if(activeTag('active').innerText === '100'){
								lastBtn.className = 'disable';
								nextBtn.className = 'disable';
							}else {
								lastBtn.className = '';
								nextBtn.className = '';
							}

						}
					}				
				}
			}

			// Handles the search items
			document.getElementById('search-btn').onclick = function () {

				let search = document.getElementById('search-box').value.toLowerCase();
				deleteItems('list');

				if(!search.trim()){
					newData = multiDimensional(data, 10);
					newData[0].forEach(obj=> each(obj));

					activeTag('active').id = '';
					numbersBtn[0].id = 'active'; 
					firstBtn.className = 'disable';
					prevBtn.className = 'disable';
					PAGI(1, true);
				}else {
					let searchedData = data.filter(a => a.name.toLowerCase().includes(search));
					newData = multiDimensional(searchedData, 10);

					activeTag('active').id = '';
					numbersBtn[0].id = 'active'; 
					firstBtn.className = 'disable';
					prevBtn.className = 'disable';
					PAGI(1, true);

					if(!searchedData.length) {
						let ans = document.getElementById('data');
						let div = document.createElement('div');
						div.id = 'list';
						div.className = 'search-not-found';
						ans.append(div);
						div.innerText = 'Search Not Found!';
					}else {
						newData[0].forEach(obj => each(obj));
					}
				} 
			}
		}


		fetch('https://data.nasa.gov/resource/gh4g-9sfh.json')
			.then(e => e.json())
			.then(data => {
				loadData(data);
			});
	 </script>
</body>
</html>